{% extends 'sitemngr/base.html' %}

{% load staticfiles %}

{% block subtitle %}
Index
{% endblock %}

{% block javascript %}
<script type="text/javascript">
	$(document).ready(function()
	{
		$('#omnibox_instructions').hide();
		$('#search_results').hide();
		$('#overlay').load('http://tracker.talkinlocal.org/sitemngr/overlay/');
		$('.message').bind('click', function() {
           $(this).hide(250);
        });
	});
	function get_tags() {
		var keyword = $('#omnibox').val();
		var flags = $('#omni_flags').val();
		if (flags == '')
		  flags = '_'
		$('#search_results').show();
		$('#search_results').load('http://tracker.talkinlocal.org/sitemngr/get_search_results/' + keyword + '/' + flags);
	}
	function toggleSection(which) {
	   $("#" + which).toggle(200);
	}
</script>
{% endblock %}

{% block content %}

<center>

{% if notices %}
    <div class="alert" id="alert_notices">
        <button type="button" class="close" onclick="$('#alert_notices').fadeOut(250);">&times;</button>
        {% for n in notices %}
            {{ n }}<br>
        {% endfor %}
    </div>
{% endif %}
{% if flag %}
    <div class="alert" id="alert_flag">
        <button type="button" class="close" onclick="$('#alert_flag').fadeOut(250);">&times;</button>
        {{ flag }}<br>
    </div>
{% endif %}

<br>
<div class="btn-group">
	<button class="btn" onclick="toggleSection('graph');">Toggle graph</button>
	<button class="btn" onclick="toggleSection('overlay');">Show Overview</button>
	<button class="btn" onclick="toggleSection('search');">Search</button>
	<button class="btn" onclick="toggleSection('index_paste');">Paste</button>
</div>

<br><br>

<div id="search" style="border: 1px solid gray; display: none;">
    <strong>Search box</strong><br>
    <a onclick="$('#omnibox_instructions').toggle(100);">Show instructions</a><br>
    <div id="omnibox_instructions" style="text-align: left; padding-left: 5px;">
        <strong>Search box</strong>
        <ul>
            <li>Start typing what you are looking for. If you're looking for a system, type the first part of it's name. Systems directly in the 
            chain are checked first, so you'll see them faster than some random system not in the chain. Same goes with tradehub systems.</li>
            <li>Typing <b>wormhole</b> or <b>site</b> (broken into <b>signature</b> and <b>anomaly</b>) will list all objects in the database of that type.</li>
            <li>If you're typing 1-3 letters in caps, the search will find all objects whose scan ids start with those letters.</li>
        </ul>
        <strong>Flags</strong>
        <ul>
            <li><i>o</i>: Only view open sites/wormholes</li>
            <li><i>c</i>: Only view closed sites/wormholes</li>
            <li><i>f</i>: Only view chain systems</li>
            <li><i>u</i>: View all systems</li>
            <li><i>m</i>: Only view systems</li>
            <li><i>w</i>: Only view wormholes</li>
            <li><i>s</i>: Only view sites</li>
        </ul>
        If you do not want to filter, leave the flags box blank.
    </div>
	<input type="text" id="omnibox" style="margin-top: 10px;" onkeyup="get_tags();" placeholder="Search...">
	<input type="text" id="omni_flags" style="margin-top: 10px; width: 10%;" onkeyup="get_tags();" placeholder="Flags">
	<img src="http://i.imgur.com/WWZwIWk.png" width="30" height="30" onclick="$('#omnibox').val(''); $('#omni_flags').val(''); $('#search_results').hide(); $('#search_results').html('');"><br>
	<div id="search_results" style="height: 200px; width: 50%; overflow: auto;"></div>
</div>
<div id="index_paste" style="border: 1px solid gray; display: none;">
    <h4>This is the same thing as the paste page, without having to load that separate page before pasting.</h4>
    <form action="/sitemngr/paste/" method="POST">
    {% csrf_token %}
        <table style="border: none;">
            <tr style="border: none;">
                <td>
                    <label><b>System</b>:</label>
                </td>
                <td>
                    <input type="text" name="system" value="{% if system %}{{ system }}{% elif eveigb.is_igb %}{{ eveigb.solarsystemname }}{% else %}J132814{% endif %}">
                </td>
            </tr>
        </table><br>
        <textarea name="pastedata" rows="20" id="ta_pastedata">{% if raw %}{{ raw }}{% endif %}</textarea><br>
        <table style="border: none;">
            <tr style="border: none;">
                <td>
                    <label><b>After downtime?</b></label>
                </td>
                <td>
                    <input type="checkbox" name="downtime" id="c_paste_downtime">
                </td>
            </tr>
        </table><br>
        <input type="submit" value="Parse" class="btn btn-primary" data-loading-text="Parsing..." onclick="$(this).button('loading');"> 
    </form>
</div>
<div id="graph" style="border: 1px solid gray; display: none;">
	<img src="{% static 'pictures/graph.png' %}" alt="Current graph not found"></img><br>
	<p><strong>
    	System outline colors: HS = gold, LS = purple, NS = brown, C1 = blue, C2 = green, C3 = yellow, C4 = orange, C5 = red, C6 = black, not found = black<br>
		Line styles: Fresh = bold, < 50% mass & < 50% time = dashed, EoL & VoC = dotted, Unknown = standard<br>
		<i>Note</i>: Dotted red lines mean that the wormhole has been "Fresh" or "Unknown" for more than 12 hours
	</strong></p>
</div>
<div id="overlay" style="width: 100%; border: 1px solid black; margin-bottom: 20px; display: none;">
    <span style="color: gray; text-align: left;">Loading ...</span>
</div>

<h5><a href="/sitemngr/system/J132814">Home System Page</a></h5>

<h5>It is currently Eve time {{ now|date:'H:i:s, N j' }}. Last update: {{ last_update_diff }} ago, by {{ last_update_user }}</h5>

<div class="row">
    <div class="span6">
        <h1>Index of {% if status and status == 'open' %}{% else %}closed {% endif %}sites</h1>
        <table class="hovertable">
            <thead>
                <tr>
                    <th>
                        Site Name
                    </th>
                    <th>
                        Scan id
                    </th>
                    <th>
                        Site Type
                    </th>
                    <th>
                        Location
                    </th>
                    <th>
                        Opened?
                    </th>
                    <th>
                        Date Entered
                    </th>
                    <th>
                        Edit
                    </th>
                </tr>
            </thread>
            <tbody>
                {% for s in sites %}
    				{% if s.isAnom %}
    				    <tr class="anom">
    				{% elif s.opened %}
    				    <tr class="open">
    				{% else %}
    				    <tr class="closed">
    				{% endif %}
    					<td>
    						<a href="/sitemngr/viewsite/{{ s.id }}">{{ s.name }}</a>
    					</td>
    					<td>
    						{{ s.scanid }}
    					</td>
    					<td>
    						{{ s.type }}
    					</td>
    					<td>
    						<a href="/sitemngr/system/{{ s.where }}">{{ s.where }}</a>
    					</td>
    					<td>
    						{% if s.opened %}<span class="g">{{ s.opened }}</span>{% else %}<span class="r">{{ s.opened }}</span>{% endif %}
    					</td>
    					<td>
    						{{ s.date|date:'m/d @ H:i' }}
    					</td>
    					<td>
    						<a href="/sitemngr/editsite/{{ s.id }}" {% if newTab %}target="_blank"{% endif %}>EDIT</a>
    					</td>
    				</tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="span6">
        <h1>Index of {% if status and status == 'open' %}{% else %}closed {% endif %}wormholes</h1>
        <table class="hovertable">
            <thead>
                <tr>
                    <th>
                        Scan ID
                    </th>
                    <th>
                        Opened in
                    </th>
                    <th>
                        Leads to
                    </th>
                    <th>
                        Time
                    </th>
                    <th>
                        Status
                    </th>
                    <th>
                        Edit
                    </th>
                </tr>
            </thead>
            <tbody>
                {% for w in wormholes %}
    				{% if w.opened %}
    				<tr class="open">
    				{% else %}
    				<tr class="closed">
    				{% endif %}
    					<td>
    						<a href="/sitemngr/viewwormhole/{{ w.id }}">{{ w.scanid }}</a>
    					</td>
    					<td>
    						<a href="/sitemngr/system/{{ w.start }}">{{ w.start }}</a>
    					</td>
    					<td>
    						{% if w.destination == 'Unknown' or w.destination == '' or w.destination == 'Unopened' or w.destination == 'Closed' %}{{ w.destination }}{% else %}<a href="/sitemngr/system/{{ w.destination }}">{{ w.destination }}</a>{% endif %}
    					</td>
    					<td>
    						{{ w.time }}
    					</td>
    					<td>
    						{{ w.status }}
    					</td>
    					<td>
    						<a href="/sitemngr/editwormhole/{{ w.id }}" {% if newTab %}target="_blank"{% endif %}>EDIT</a>
    					</td>
    				</tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<br><br><br>
<p style="font-size: 200%;">
    {% if status and status == 'open' %}
        <a href="/sitemngr/viewall/">View closed</a>
    {% else %}
        <a href="/sitemngr/">Back</a>
    {% endif %}
    <br>
</p>
<a href="/sitemngr/refreshgraph/">Manually refresh graph</a>

</center>

{% endblock %}
